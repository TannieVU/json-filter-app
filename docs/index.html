<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ứng dụng lọc JSON</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    function App() {
      const [jsonInput, setJsonInput] = React.useState('');
      const [textInput, setTextInput] = React.useState('');
      const [filteredJson, setFilteredJson] = React.useState('');
      const [isProcessed, setIsProcessed] = React.useState(false);
      const [error, setError] = React.useState('');

      const jsonRef = React.useRef(null);
      const textRef = React.useRef(null);
      const filteredJsonRef = React.useRef(null);

      const processJson = () => {
        try {
          setError('');
          // Parse JSON input
          const jsonData = JSON.parse(jsonInput);
          const text = textInput;

          // Process pronouns
          const filteredPronouns = jsonData.pronouns ? jsonData.pronouns.filter(pronoun => 
            text.includes(pronoun.pronoun)
          ) : [];

          // Process names
          const filteredNames = jsonData.names ? jsonData.names.filter(nameObj => 
            text.includes(nameObj.original)
          ) : [];

          // Process terms
          const filteredTerms = jsonData.terms ? jsonData.terms.filter(termObj => 
            text.includes(termObj.term)
          ) : [];

          // Create new filtered JSON
          const newJson = {
            ...(filteredPronouns.length > 0 && { pronouns: filteredPronouns }),
            ...(filteredNames.length > 0 && { names: filteredNames }),
            ...(filteredTerms.length > 0 && { terms: filteredTerms })
          };

          // Format and set the filtered JSON
          setFilteredJson(JSON.stringify(newJson, null, 2));
          setIsProcessed(true);
        } catch (err) {
          setError('Lỗi xử lý JSON: ' + err.message);
          setIsProcessed(false);
        }
      };

      const copyToClipboard = (text, ref) => {
        if (ref && ref.current) {
          ref.current.select();
          document.execCommand('copy');
        } else {
          const tempTextArea = document.createElement('textarea');
          tempTextArea.value = text;
          document.body.appendChild(tempTextArea);
          tempTextArea.select();
          document.execCommand('copy');
          document.body.removeChild(tempTextArea);
        }
      };

      return (
        <div className="min-h-screen bg-gray-100 py-8 px-4">
          <div className="max-w-4xl mx-auto">
            <h1 className="text-2xl font-bold text-center mb-8">Ứng dụng lọc JSON dựa trên văn bản</h1>
            
            {error && (
              <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                {error}
              </div>
            )}
            
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
              <div>
                <label className="block mb-2 font-medium">JSON đầu vào:</label>
                <textarea
                  ref={jsonRef}
                  className="w-full h-64 p-3 border rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                  value={jsonInput}
                  onChange={(e) => setJsonInput(e.target.value)}
                  placeholder="Dán JSON vào đây..."
                />
                <button 
                  className="mt-2 bg-blue-500 text-white py-1 px-3 rounded hover:bg-blue-600"
                  onClick={() => copyToClipboard(jsonInput, jsonRef)}
                >
                  Sao chép
                </button>
              </div>
              
              <div>
                <label className="block mb-2 font-medium">Văn bản:</label>
                <textarea
                  ref={textRef}
                  className="w-full h-64 p-3 border rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                  value={textInput}
                  onChange={(e) => setTextInput(e.target.value)}
                  placeholder="Dán văn bản vào đây..."
                />
                <button 
                  className="mt-2 bg-blue-500 text-white py-1 px-3 rounded hover:bg-blue-600"
                  onClick={() => copyToClipboard(textInput, textRef)}
                >
                  Sao chép
                </button>
              </div>
            </div>
            
            <div className="text-center mb-6">
              <button
                className="bg-green-600 text-white py-2 px-6 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500"
                onClick={processJson}
              >
                Lọc JSON
              </button>
            </div>
            
            {isProcessed && (
              <div className="mt-8">
                <div className="mb-6">
                  <h2 className="text-xl font-semibold mb-3">JSON đã lọc:</h2>
                  <div className="relative">
                    <textarea
                      ref={filteredJsonRef}
                      className="w-full h-64 p-3 border rounded shadow-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                      value={filteredJson}
                      readOnly
                    />
                    <button 
                      className="mt-2 bg-blue-500 text-white py-1 px-3 rounded hover:bg-blue-600"
                      onClick={() => copyToClipboard(filteredJson, filteredJsonRef)}
                    >
                      Sao chép
                    </button>
                  </div>
                </div>
                
                <div>
                  <h2 className="text-xl font-semibold mb-3">Văn bản của bạn:</h2>
                  <div className="relative">
                    <textarea
                      className="w-full h-40 p-3 border rounded shadow-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                      value={textInput}
                      readOnly
                    />
                    <button 
                      className="mt-2 bg-blue-500 text-white py-1 px-3 rounded hover:bg-blue-600"
                      onClick={() => copyToClipboard(textInput)}
                    >
                      Sao chép
                    </button>
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>